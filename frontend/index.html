<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Cricket Match</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 30px;
    }
    .card {
      background: #1e293b;
      padding: 20px;
      border-radius: 10px;
      width: 420px;
    }
    .title {
      font-size: 22px;
      margin-bottom: 10px;
    }
    .live {
      color: #22c55e;
      font-weight: bold;
    }
    .value {
      font-size: 18px;
      margin: 8px 0;
    }
    select {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

  <div class="card">
    <div class="title">üèè Live Match <span class="live">‚óè LIVE</span></div>

    <select id="matchSelect">
      <option>Loading matches...</option>
    </select>

    <div class="value">Match ID: <span id="matchId">-</span></div>
    <div class="value">Overs: <span id="overs">0.0</span></div>
    <div class="value">Runs: <span id="runs">0</span></div>
    <div class="value">Wickets: <span id="wickets">0</span></div>
    <div class="value">Last Ball: <span id="commentary">-</span></div>

    <hr />
    <div class="value">WebSocket: <span id="status">Disconnected</span></div>
  </div>

  <script>
    let ws = null;

    async function loadMatches() {
      const res = await fetch("http://localhost:8000/matches/live");
      const matches = await res.json();

      const select = document.getElementById("matchSelect");
      select.innerHTML = "";

      matches.forEach(match => {
        const option = document.createElement("option");
        option.value = match.id;
        option.text = `${match.team_a} vs ${match.team_b}`;
        select.appendChild(option);
      });

      if (matches.length > 0) {
        connectWebSocket(matches[0].id);
      }

      select.onchange = () => connectWebSocket(select.value);
    }

    function connectWebSocket(matchId) {
      if (ws) ws.close();

      document.getElementById("matchId").innerText = matchId;
      document.getElementById("status").innerText = "Connecting...";

      ws = new WebSocket(`ws://localhost:8000/ws/match/${matchId}`);

      ws.onopen = () => {
        document.getElementById("status").innerText = "Connected";
      };

      ws.onclose = () => {
        document.getElementById("status").innerText = "Disconnected";
      };

      ws.onerror = () => {
        document.getElementById("status").innerText = "Error";
      };

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.type === "BALL") {
          document.getElementById("overs").innerText = data.over;
          document.getElementById("runs").innerText = data.runs;
          document.getElementById("wickets").innerText = data.wicket ? "Yes" : "No";
          document.getElementById("commentary").innerText = data.commentary;
        }

        if (data.type === "MATCH_END") {
          document.getElementById("status").innerText = "Match Finished";
        }
      };
    }

    loadMatches();
  </script>

</body>
</html>
